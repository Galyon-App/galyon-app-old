<!-- 

  Authors : Bytes Crafter
  Website : https://bytescrafter.net
  App Name : Galyon App
  Created : 01-Sep-2020

 -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="back()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{name}}</ion-title>
    <ion-buttons slot="end">
      <!-- <ion-button (click)="search()">
        <ion-icon slot="icon-only" name="search-outline"></ion-icon>
      </ion-button> -->
      <!-- <ion-button (click)="onChat()">
        <ion-icon slot="icon-only" name="chatbubbles-outline"></ion-icon>
      </ion-button> -->
    </ion-buttons>
  </ion-toolbar>
  <!-- *ngIf="haveSearch" showCancelButton="always" -->
  <ion-searchbar mode="ios" (ionCancel)="search()" [placeholder]="util.getString('Search')"
    type="text" (ionChange)="onSearchChange($event)" [debounce]="250" style="background-color: var(--ion-color-light);">
  </ion-searchbar>
  <div class="topHeader" *ngIf="products?.length">
    <p class="itemsFound">
      {{products.length}} {{util.getString('Items')}}
    </p>
    <div>
      <ion-button (click)="changeMode()" color="light" size="small">
        <ion-icon slot="icon-only" [name]="mode ==='list' ? 'apps' :'list'"></ion-icon>
      </ion-button>
      <ion-button (click)="filter($event)" color="light" size="small">
        <ion-icon slot="start" name="options"></ion-icon>
        {{util.getString('Filter')}} {{selectedFilter}}
      </ion-button>
      <ion-button (click)="priceFilter()" color="light" size="small">
        <ion-icon slot="icon-only" name="filter"></ion-icon>
      </ion-button>
    </div>
  </div>
</ion-header>

<ion-content>
  <div class="main_content">
    <p class="ion-text-center" *ngIf="!dummy?.length && !products?.length"> {{util.getString('No Products found')}} </p>

    <ion-row>
      <ion-col size="6" *ngFor="let item of dummy">
        <ion-skeleton-text animated style="width: 100%;height: 100px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 70%;height: 10px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 50%;height: 10px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 80%;height: 10px;"></ion-skeleton-text>
      </ion-col>
    </ion-row>
    <ion-row *ngIf="mode === 'grid'">

      <ion-col size="6" *ngFor="let item of products;let i = index;">
        <div style="border: 1px solid lightgray;">
          <div class="back_image" [ngStyle]="{'background-image':'url('+api.mediaURL+item.cover+'),url(assets/imgs/product.png)'}"
            (click)="singleProduct(item)">
            <div class="percent" *ngIf="item.discount_type !== 'none' && item.discount > 0"> {{item.discount}} </div>
            <div *ngIf="item.in_stock === '0'" class="notInStock">
              <ion-label class="text"> {{util.getString('Out of Stock')}} </ion-label>
            </div>
            <img src="assets/imgs/normal.png" class="kind" alt="Verified" *ngIf="item.verified_at !== null">
            <img src="assets/imgs/verified.png" class="kind" alt="Normal" *ngIf="item.verified_at === null">
          </div>
          <div class="second_div">
            <ion-label class="name_lbl" (click)="singleProduct(item)">
              {{ (item.name.length>20)? (item.name | slice:0:20)+'..':(item.name) }}
            </ion-label>
            <div *ngIf="item.variations" class="variant" (click)="variant(item,i)">
              <ion-label *ngFor="let parent_var of item.variations;let pvar_id = index;" (click)="variant(item,pvar_id)" class="selecter ion-activatable">
                <span>
                  <span> 
                    {{ parent_var && parent_var.items[parent_var.current].title ? ' * ' + parent_var.items[parent_var.current].title : ''}}
                  </span>
                  <span *ngIf="util.cside ==='left'" class="price_lbl"> 
                    {{util.currecny}}
                    <span class="original" *ngIf="parent_var.items[parent_var.current].discount">
                      {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                    </span>
                    <span class="sell" *ngIf="parent_var.items[parent_var.current].discount">
                      {{parent_var.items[parent_var.current].discount ? parent_var.items[parent_var.current].discount : 0}}
                    </span>
                    <span
                      *ngIf="!parent_var.items[parent_var.current].discount">
                      {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                    </span>
                  </span>
                  <span *ngIf="util.cside ==='right'">
                    <span class="original" *ngIf="parent_var.items[parent_var.current].discount">
                      {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                    </span>
                    <span class="sell" *ngIf="parent_var.items[parent_var.current].discount">
                      {{ parent_var.items[parent_var.current].discount ? parent_var.items[parent_var.current].discount : 0}}
                    </span>
                    <span
                      *ngIf="!parent_var.items[parent_var.current].discount">
                      {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                    </span>
                    {{util.currecny}}
                  </span>
                </span>
                <ion-icon slot="start" name="caret-down-outline"></ion-icon>
                <ion-ripple-effect type="bounded"></ion-ripple-effect>
              </ion-label>
              <!-- <ion-label class="selecter ion-activatable">
                <span>
                  <span> {{
                    item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                    item.variations[0].items[item.variant].title ?
                    item.variations[0].items[item.variant].title : ''}} </span>
                  -
                  <span *ngIf="util.cside ==='left'" class="price_lbl"> {{util.currecny}}
                    <span class="original" *ngIf="item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                            item.variations[0].items[item.variant].discount">
                      {{ item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                      item.variations[0].items[item.variant].price ?
                      item.variations[0].items[item.variant].price : 0}}
                    </span>
                    <span class="sell" *ngIf="item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                            item.variations[0].items[item.variant].discount"> {{item.variations && item.variations[0]
                      && item.variations[0].items[item.variant] &&
                      item.variations[0].items[item.variant].discount ?
                      item.variations[0].items[item.variant].discount : 0}}
                    </span>
                    <span
                      *ngIf="item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                            item.variations[0].items[item.variant].discount === 0 && !item.variations[0].items[item.variant].discount">
                      {{ item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                      item.variations[0].items[item.variant].price ?
                      item.variations[0].items[item.variant].price : 0}}
                    </span>

                  </span>
                  <span *ngIf="util.cside ==='right'">
                    <span class="original" *ngIf="item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                            item.variations[0].items[item.variant].discount">
                      {{ item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                      item.variations[0].items[item.variant].price ?
                      item.variations[0].items[item.variant].price : 0}}
                    </span>
                    <span class="sell" *ngIf="item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                            item.variations[0].items[item.variant].discount"> {{item.variations && item.variations[0]
                      && item.variations[0].items[item.variant] &&
                      item.variations[0].items[item.variant].discount ?
                      item.variations[0].items[item.variant].discount : 0}}
                    </span>
                    <span
                      *ngIf="item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                            item.variations[0].items[item.variant].discount === 0 && !item.variations[0].items[item.variant].discount">
                      {{ item.variations && item.variations[0] && item.variations[0].items[item.variant] &&
                      item.variations[0].items[item.variant].price ?
                      item.variations[0].items[item.variant].price : 0}}
                    </span>
                    {{util.currecny}}
                  </span>
                </span>
                <ion-icon slot="start" name="caret-down-outline"></ion-icon>
                <ion-ripple-effect type="bounded"></ion-ripple-effect>
              </ion-label> -->
            </div>
            <ion-label class="itemsKind" *ngIf="item.variations">
              <span *ngIf="item.have_gram === '1'"> {{item.gram}} {{util.getString('grams')}} </span>
              <span *ngIf="item.have_kg === '1'"> {{item.kg}} {{util.getString('kg')}} </span>
              <span *ngIf="item.have_liter ==='1'"> {{item.liter}} {{util.getString('ltr')}} </span>
              <span *ngIf="item.have_ml ==='1'"> {{item.ml}} {{util.getString('ml')}} </span>
              <span *ngIf="item.have_pcs === '1'"> {{item.pcs}} {{util.getString('pcs')}} </span>
            </ion-label>
            <div *ngIf="item.variations">
              <ion-label class="price_lbl" *ngIf="item.discount === '0' && util.cside ==='left'"> {{util.currecny}}
                {{item.original_price}} </ion-label>
              <ion-label class="price_lbl" *ngIf="item.discount === '0' && util.cside ==='right'">
                {{item.original_price}}
                {{util.currecny}}</ion-label>
              <ion-label class="price_lbl" *ngIf="item.discount !== '0'" (click)="singleProduct(item)">
                <span class="original" *ngIf="util.cside ==='left'"> {{util.currecny}} {{item.original_price}} </span>
                <span class="sell" *ngIf="util.cside ==='left'">{{util.currecny}} {{item.sell_price}} </span>

                <span class="original" *ngIf="util.cside ==='right'"> {{item.original_price}} {{util.currecny}}</span>
                <span class="sell" *ngIf="util.cside ==='right'"> {{item.sell_price}} {{util.currecny}}</span>

              </ion-label>
            </div>
            <div class="btnBtm"
              *ngIf="!cart.itemId.includes(item.id) && item.quantiy <= 0 && item.in_stock === '1' && storeIsActive === true">
              <div class="ion-activatable ripple-parent" (click)="addToCart(item,i)">
                {{util.getString('Add')}}
                <ion-ripple-effect></ion-ripple-effect>
              </div>
            </div>
            <div *ngIf="item.in_stock !== '1'" style="height:30px"></div>

            <div class="cartBtn" *ngIf="cart.itemId.includes(item.id)">
              <div class="abs_add">
                <img src="assets/imgs/remove.png" (click)="remove(item,i)">
                <ion-label *ngIf="item.quantiy !== 0">{{item.quantiy}}</ion-label>
                <ion-label *ngIf="item.quantiy === 0">
                  <ion-spinner name="circles" color="light"></ion-spinner>
                </ion-label>
                <img src="assets/imgs/add.png" (click)="add(item,i)">
              </div>
            </div>
          </div>
        </div>
      </ion-col>
    </ion-row>
    <div *ngIf="mode ==='list'">
      <div class="card_div" *ngFor="let item of products;let i = index">
        <div class="back_image" [ngStyle]="{'background-image':'url('+api.mediaURL+item.cover+'),url(assets/imgs/product.png)'}"
          (click)="singleProduct(item)">
          <div class="percent" *ngIf="item.discount !== '0'"> {{item.discount}}% </div>
          <div *ngIf="item.in_stock === '0'" class="notInStock">
            <ion-label class="text"> {{util.getString('Out of Stock')}} </ion-label>
          </div>
        </div>
        <div class="second_div">
          <ion-label class="name_lbl">
            {{ (item.name.length>20)? (item.name | slice:0:20)+'..':(item.name) }}
          </ion-label>
          <img src="assets/imgs/normal.png" class="kind" alt="Verified" *ngIf="item.verified_at !== null">
          <img src="assets/imgs/verified.png" class="kind" alt="Normal" *ngIf="item.verified_at === null">
          <img src="assets/imgs/offer.png" class="offer" alt="Offer" *ngIf="item.in_offer ==='1'">
          <div *ngIf="item.variations" class="variant" (click)="variant(item,i)">
            <ion-label *ngFor="let parent_var of item.variations;let pvar_id = index;" (click)="variant(item,pvar_id)" class="selecter ion-activatable">
              <span>
                <span> 
                  {{ parent_var && parent_var.items[parent_var.current].title ? ' * ' + parent_var.items[parent_var.current].title : ''}}
                </span>
                <span *ngIf="util.cside ==='left'" class="price_lbl"> 
                  {{util.currecny}}
                  <span class="original" *ngIf="parent_var.items[parent_var.current].discount">
                    {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                  </span>
                  <span class="sell" *ngIf="parent_var.items[parent_var.current].discount">
                    {{parent_var.items[parent_var.current].discount ? parent_var.items[parent_var.current].discount : 0}}
                  </span>
                  <span
                    *ngIf="!parent_var.items[parent_var.current].discount">
                    {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                  </span>
                </span>
                <span *ngIf="util.cside ==='right'">
                  <span class="original" *ngIf="parent_var.items[parent_var.current].discount">
                    {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                  </span>
                  <span class="sell" *ngIf="parent_var.items[parent_var.current].discount">
                    {{ parent_var.items[parent_var.current].discount ? parent_var.items[parent_var.current].discount : 0}}
                  </span>
                  <span
                    *ngIf="!parent_var.items[parent_var.current].discount">
                    {{ parent_var.items[parent_var.current].price ? parent_var.items[parent_var.current].price : 0}}
                  </span>
                  {{util.currecny}}
                </span>
              </span>
              <ion-icon slot="start" name="caret-down-outline"></ion-icon>
              <ion-ripple-effect type="bounded"></ion-ripple-effect>
            </ion-label>
          </div>
          <ion-label class="itemsKind" *ngIf="item.variations">
            <span *ngIf="item.have_gram === '1'"> {{item.gram}} {{util.getString('grams')}} </span>
            <span *ngIf="item.have_kg === '1'"> {{item.kg}} {{util.getString('kg')}} </span>
            <span *ngIf="item.have_liter ==='1'"> {{item.liter}} {{util.getString('ltr')}} </span>
            <span *ngIf="item.have_ml ==='1'"> {{item.ml}} {{util.getString('ml')}} </span>
            <span *ngIf="item.have_pcs === '1'"> {{item.pcs}} {{util.getString('pcs')}} </span>
          </ion-label>
          <div *ngIf="item.variations">
            <ion-label class="price_lbl" *ngIf="item.discount === '0' && util.cside ==='left'"> {{util.currecny}}
              {{item.original_price}} </ion-label>
            <ion-label class="price_lbl" *ngIf="item.discount === '0' && util.cside ==='right'">{{item.original_price}}
              {{util.currecny}}</ion-label>
            <ion-label class="price_lbl" *ngIf="item.discount !== '0'" (click)="singleProduct(item)">
              <span class="original" *ngIf="util.cside ==='left'"> {{util.currecny}} {{item.original_price}} </span>
              <span class="sell" *ngIf="util.cside ==='left'">{{util.currecny}} {{item.sell_price}} </span>

              <span class="original" *ngIf="util.cside ==='right'"> {{item.original_price}} {{util.currecny}}</span>
              <span class="sell" *ngIf="util.cside ==='right'"> {{item.sell_price}} {{util.currecny}}</span>

            </ion-label>
          </div>
          <div class="btnBtm"
            *ngIf="!cart.itemId.includes(item.id) && item.quantiy <= 0 && item.in_stock === '1' && storeIsActive === true">
            <div class="ion-activatable ripple-parent" (click)="addToCart(item,i)">
              {{util.getString('Add to Cart')}}
              <ion-ripple-effect></ion-ripple-effect>
            </div>
          </div>
          <div class="cartBtn" *ngIf="cart.itemId.includes(item.id)">
            <div class="abs_add">
              <img src="assets/imgs/remove.png" (click)="remove(item,i)">
              <ion-label>{{item.quantiy}}</ion-label>
              <img src="assets/imgs/add.png" (click)="add(item,i)">
            </div>
          </div>
        </div>
      </div>
    </div>
    <ion-infinite-scroll threshold="100px" (ionInfinite)="loadData($event)" style="padding: 25px;">
      <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="">
        <ion-label>Please wait...</ion-label>
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </div>

</ion-content>