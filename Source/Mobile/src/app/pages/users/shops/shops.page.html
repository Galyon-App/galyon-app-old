<!-- 

  Authors : Bytes Crafter
  Website : https://bytescrafter.net
  App Name : Galyon App
  Created : 01-Sep-2020

 -->

 <ion-content>
  <div class="main_content_div">
  <ion-refresher slot="fixed" pullFactor="0.5" pullMin="100" pullMax="200" (ionRefresh)="homeRefresh($event)">
    <ion-refresher-content
      style="padding-top: 30px;"
      closeDuration="1000"
      pullingIcon="chevron-down-circle-outline"
      pullingText="Pull to refresh"
      refreshingSpinner="circles"
      refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>

  <ion-slides *ngIf="homeLayout == '1'" class="headerSlides" [options]="slideHead" >
    <ion-slide *ngFor="let item of banners">
      <div class="whole" (click)="openLink(item)">
        <div class="image" [ngStyle]="{'background-image':'url('+api.mediaURL+item.cover+'),url(assets/imgs/banner.png)'}">
        </div>
      </div>
    </ion-slide>
  </ion-slides>

  <div class="flx">
    <ion-searchbar [placeholder]="util.getString('Search...')" [(ngModel)]="terms" inputmode="text" type="search"
      (keyup.enter)="search(q.value)" (ionChange)="onSearchChange($event)" #q [debounce]="250" mode="ios"
      showCancelButton="never">
    </ion-searchbar>
  </div>
  <div class="searchList" *ngIf="products?.length" style="margin-bottom: 15px;">
    <ion-item *ngFor="let item of products" (click)="openStore(item)">
      <img [src]="api.mediaURL + item.cover" alt="..." (error)="'assets/imgs/store.png'" 
      style="object-fit: cover;
      border-radius: 50px;
      border: 1px solid #ededed;
      height: 30px;
      width: 30px;
      padding: 0 10px;">
      <ion-label style="padding: 10px;">{{item.name}}</ion-label>
      <ion-icon name="arrow-redo-outline" slot="end"></ion-icon>
    </ion-item>
  </div>
  
  <div class="main_content_div">


    <!-- START BETWEEN BANNER -->
    <div class="slider_div" *ngIf="betweenBanners.length > 0 && betweenDummy.length == 0">
      <ion-slides [options]="slideOpts">
        <ion-slide *ngFor="let item of betweenDummy">
          <div class="card">
            <ion-skeleton-text animated style="width: 100%;"></ion-skeleton-text>
          </div>
        </ion-slide>
        <ion-slide *ngFor="let item of betweenBanners">
          <div class="card">
            <div class="back_image" [ngStyle]="{'background-image':'url('+api.mediaURL+item.cover+'),url(assets/imgs/banner.png)'}"
              (click)="openLink(item)" style="height: 24vw;">
              <!-- <div class="overlay_div" *ngIf="item.message">
                <ion-label> {{item.message}} </ion-label>
              </div> -->
            </div>
          </div>
        </ion-slide>
      </ion-slides>
    </div>
    <!-- END BETWEEN BANNER -->

    <!-- START TOP STORES -->
    <div *ngIf="featuredStores.length > 0 && dummyFeaturedStores.length == 0" class="segment-title" style="margin-top: 15px;">
      <ion-label class="all"> {{util.getString('Featured Stores')}} </ion-label>
      <ion-label class="view" (click)="topStores()">{{util.getString('More')}}
        <div class="ion-activatable">
          <ion-ripple-effect type="bounded"></ion-ripple-effect>
        </div>
        <ion-icon name="chevron-forward-outline" color="primary"></ion-icon>
      </ion-label>
    </div>
    <div *ngIf="featuredStores.length > 0 && dummyFeaturedStores.length == 0" class="topProducts">
      <ion-list>
        <ion-item lines="none" *ngFor="let item of dummyFeaturedStores">
          <div class="content_div">
            <div class="card_div">
              <div class="image_div">
                <ion-skeleton-text animated></ion-skeleton-text>
              </div>
              <div class="desc_div">
                <ion-skeleton-text animated class="pro_name"></ion-skeleton-text>
                <ion-skeleton-text animated class="pro_detail"></ion-skeleton-text>
                <ion-skeleton-text animated class="price_lbl"></ion-skeleton-text>
                <ion-skeleton-text animated class="small_flex"></ion-skeleton-text>
              </div>
            </div>
          </div>
        </ion-item>
        <div class="main_list_div">
          <div class="card_div" *ngFor="let item of featuredStores">
            <div class="image_div bg_image" style="background-repeat: no-repeat; background-position: center; background-size: cover;"
              [ngStyle]="{'background-image':'url('+ api.mediaURL+item.cover+'),url(assets/imgs/store.png)'}" (click)="openStore(item)"></div>
    
            <div class="detail_div">
              <ion-label class="name" (click)="openStore(item)">{{item.name}}</ion-label>
              <ion-label class="address">{{item.address}}</ion-label>
              <ion-label class="price_lbl"> {{getTime(item.open_time)}} - {{getTime(item.close_time)}} </ion-label>
              <ion-grid fixed style="color: var(--ion-color-primary);">
                <ion-row>
                  <ion-col size="4" (click)="openInMap()">
                    <ion-icon name="map" style="font-size: 22px;"></ion-icon>
                    <ion-label>Map</ion-label>
                  </ion-col>
                  <ion-col size="4" (click)="openListShops()">
                    <ion-icon name="basket" style="font-size: 22px;"></ion-icon>
                    <ion-label>Shops</ion-label>
                  </ion-col>
                  <ion-col size="4" style="border-right: none;" (click)="openContactInfo()">
                    <ion-icon name="call" style="font-size: 22px;"></ion-icon>
                    <ion-label>Contact</ion-label>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </div>
          </div>
        </div>
      </ion-list>
    </div>
    <!-- END TOP PRODUCTS -->
    
    <!-- START BOTTOM BANNER -->
    <div class="slider_div" *ngIf="bottomBanners.length > 0 && bottomDummy.length == 0 && featuredStores.length > 0 && dummyFeaturedStores.length == 0">
      <ion-slides [options]="slideOpts">
        <ion-slide *ngFor="let item of bottomDummy">
          <div class="card">
            <ion-skeleton-text animated style="width: 100%;"></ion-skeleton-text>
          </div>
        </ion-slide>
        <ion-slide *ngFor="let item of bottomBanners">
          <div class="card">
            <div class="back_image" [ngStyle]="{'background-image':'url('+api.mediaURL+item.cover+'),url(assets/imgs/banner.png)'}"
              (click)="openLink(item)" style="height: 24vw;">
              <!-- <div class="overlay_div" *ngIf="item.message">
                <ion-label> {{item.message}} </ion-label>
              </div> -->
            </div>
          </div>
        </ion-slide>
      </ion-slides>
    </div>
    <!-- END BOTTOM BANNER -->

    <!--  START INFINITY STORES -->
    <div class="segment-title" style="margin-top: 15px;">
      <ion-label class="all"> {{util.getString('Official Stores')}} </ion-label>
      <!-- <ion-label class="view" (click)="topStores()">{{util.getString('More')}}
        <div class="ion-activatable">
          <ion-ripple-effect type="bounded"></ion-ripple-effect>
        </div>
        <ion-icon name="chevron-forward-outline" color="primary"></ion-icon>
      </ion-label> -->
    </div>
    <ion-list *ngIf="haveStores == true">
      <ion-item lines="none" *ngFor="let item of dummyStores">
        <div class="allstore_div">
          <div class="card_div">
            <div class="image_div">
              <ion-skeleton-text animated></ion-skeleton-text>
            </div>
            <div class="desc_div">
              <ion-skeleton-text animated class="pro_name"></ion-skeleton-text>
              <ion-skeleton-text animated class="pro_detail"></ion-skeleton-text>
              <ion-skeleton-text animated class="price_lbl"></ion-skeleton-text>
              <ion-skeleton-text animated class="small_flex"></ion-skeleton-text>
            </div>
          </div>
        </div>
      </ion-item>

      <div class="main_list_div">
        <div class="card_div" *ngFor="let item of stores">
          <div class="image_div bg_image" style="background-repeat: no-repeat; background-position: center; background-size: cover;"
            [ngStyle]="{'background-image':'url('+ api.mediaURL+item.cover+'),url(assets/imgs/store.png)'}" (click)="openStore(item)"></div>
    
            <div class="detail_div">
              <ion-label class="name" (click)="openStore(item)">{{item.name}}</ion-label>
              <ion-label class="address">{{item.address}}</ion-label>
              <ion-label class="price_lbl"> {{getTime(item.open_time)}} - {{getTime(item.close_time)}} </ion-label>
              <ion-grid fixed style="color: var(--ion-color-primary);">
                <ion-row>
                  <ion-col size="4" (click)="openInMap()">
                    <ion-icon name="map" style="font-size: 22px;"></ion-icon>
                    <ion-label>Map</ion-label>
                  </ion-col>
                  <ion-col size="4" (click)="openListShops()">
                    <ion-icon name="basket" style="font-size: 22px;"></ion-icon>
                    <ion-label>Shops</ion-label>
                  </ion-col>
                  <ion-col size="4" style="border-right: none;" (click)="openContactInfo()">
                    <ion-icon name="call" style="font-size: 22px;"></ion-icon>
                    <ion-label>Contact</ion-label>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </div>
        </div>
      </div>
      
    </ion-list>
    <div *ngIf="haveStores == true && no_stores_follows == true" style="display: flex; flex-direction: column; margin: 0 0 20px;">
      <p class="ion-text-center"> {{util.getString('- Nothing Follows -')}} </p>
    </div>
    <ion-infinite-scroll threshold="100px" (ionInfinite)="loadData($event)" [ngStyle]="{'display': no_stores_follows ? 'none':'block'}" style="padding: 20px;">
      <ion-infinite-scroll-content loadingSpinner="circles" loadingText="Please wait...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
    <div *ngIf="haveStores == false" class="nothing">
      <img src="assets/imgs/nothing.png" alt="" srcset="" class="imgs">
      <p class="ion-text-center">Sorry, no stores near you! <br>Try selecting the another city.</p>
    </div>
    <!--  END INFINITY STORES -->

  </div>
</div>
  
</ion-content>