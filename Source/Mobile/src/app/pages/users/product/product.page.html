<!-- 

  Authors : Bytes Crafter
  Website : https://bytescrafter.net
  App Name : Galyon App
  Created : 01-Sep-2020

 -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="back()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title> {{name}} </ion-title>
    <!-- <ion-buttons slot="end" *ngIf="loaded && name">
      <ion-button (click)="onFav()">
        <ion-icon slot="icon-only" [name]="util.favIds.includes(id)?'heart': 'heart-outline'"></ion-icon>
      </ion-button>
    </ion-buttons> -->
  </ion-toolbar>
</ion-header>

<ion-content>
  <div *ngIf="!loaded" style="display: flex;flex-direction: column;justify-content: center;align-items: center;">
    <ion-spinner color="primary" name="crescent"></ion-spinner>
  </div>
  <div class="slider_div" *ngIf="loaded && name">
    <ion-slides [options]="slideOpts" pager>
      <ion-slide *ngFor="let item of gallery">
        <div class="back_image" (click)="openViewer(api.mediaURL+item)"
          [ngStyle]="{'background-image':'url('+api.mediaURL+item+'),url(assets/imgs/product.png)'}">
        </div>
      </ion-slide>
    </ion-slides>
  </div>
  <div class="main_content_div" *ngIf="loaded && name">

    <div class="detail_div">
      <ion-label class="pro_name">{{name}}</ion-label>

      <ion-label class="itemsKind">
        <span *ngIf="have_gram === '1'"> {{gram}} grams </span>
        <span *ngIf="have_kg === '1'"> {{kg}} kg </span>
        <span *ngIf="have_liter ==='1'"> {{liter}} ltr </span>
        <span *ngIf="have_ml ==='1'"> {{ml}} ml</span>
        <span *ngIf="have_pcs === '1'"> {{pcs}} pcs </span>
      </ion-label>

      <div class="storeName ion-activatable" (click)="gotoStore()" *ngIf="storeName">
        {{ (storeName.length>42)? (storeName | slice:0:42)+'..':(storeName) }}
      </div>

      <div class="ratingItems ion-activatable" (click)="productRating()">
        <ion-icon [name]="rate >= 1 ? 'star':'star'" [color]="rate >= 1 ? 'warning':'medium'">
        </ion-icon>
        <ion-icon [name]="rate >= 2 ? 'star':'star'" [color]="rate >= 2 ? 'warning':'medium'">
        </ion-icon>
        <ion-icon [name]="rate >= 3 ? 'star':'star'" [color]="rate >= 3 ? 'warning':'medium'">
        </ion-icon>
        <ion-icon [name]="rate >= 4 ? 'star':'star'" [color]="rate >= 4 ? 'warning':'medium'">
        </ion-icon>
        <ion-icon [name]="rate >= 5 ? 'star':'star'" [color]="rate >= 5 ? 'warning':'medium'">
        </ion-icon>
        ({{totalRating}} {{util.getString('Rating')}})
        <ion-ripple-effect></ion-ripple-effect>
      </div>

      <ion-label class="price_lbl" *ngIf="util.cside ==='left'" style="color: var(--ion-color-primary); font-size: 25px; margin-top: 10px;">
        {{util.currecny}}
        {{ product.sell_price}}
      </ion-label>
      <ion-label class="price_lbl" *ngIf="util.cside ==='right'" style="color: var(--ion-color-primary); font-size: 25px; margin-top: 10px;">
        {{ product.sell_price}}
        {{util.currecny}}
      </ion-label>
      <div class="left">
        <!-- <img src="assets/imgs/normal.png" *ngIf="veg==='1'">
        <img src="assets/imgs/verified.png" *ngIf="veg==='0'"> -->
        <div>
          <ion-label class="price_lbl" *ngIf="this.discount !== '0'">
            <span class="original" style="text-decoration: line-through;" *ngIf="util.cside ==='left'"> {{util.currecny}} {{ product.orig_price}} </span>
            <span class="sell" *ngIf="util.cside ==='left'"> {{ product.discount}} {{ getDiscountSuffix() }} </span>
            <span class="original" style="text-decoration: line-through;" *ngIf="util.cside ==='right'"> {{ product.orig_price}} {{util.currecny}}</span>
            <span class="sell" *ngIf="util.cside ==='right'"> {{ product.discount}} {{ getDiscountSuffix() }}</span>
          </ion-label>
        </div>
      </div>

      
      <div class="variant">
        <ion-label *ngFor="let parent_var of product.variations;let pvar_id = index;" (click)="variant(pvar_id)" class="selecter ion-activatable">
          <span style="width: -webkit-fill-available; padding: 2px 5px;">
            <span style="font-size: 14px;"> 
              {{ parent_var && parent_var.items[parent_var.current].title ? ' * ' + parent_var.items[parent_var.current].title : ''}} &nbsp;&nbsp; 
            </span>
            <span class="price_lbl" style="float: right; padding-right: 10px;"> 
              <span *ngIf="parent_var.items[parent_var.current].price == 0 && parent_var.items[parent_var.current].discount == 0">
                FREE
              </span>
              <span *ngIf="parent_var.items[parent_var.current].price > 0 && parent_var.items[parent_var.current].discount == 0">
                {{util.cside ==='left' ? util.currecny : "" }}
                {{parent_var.items[parent_var.current].price.toFixed(2)}}
                <!-- TODO: {{util.cside ==='right' ? "" : util.currecny }} -->
              </span>
              <span *ngIf="parent_var.items[parent_var.current].price > 0 && parent_var.items[parent_var.current].discount > 0">
                {{util.cside ==='left' ? util.currecny : "" }}
                {{
                  (parent_var.items[parent_var.current].price - (parent_var.items[parent_var.current].price*(parent_var.items[parent_var.current].discount/100))).toFixed(2)
                }}
                <!-- TODO: {{util.cside ==='right' ? "" : util.currecny }} -->
              </span>
            </span>
          </span>
          <ion-icon slot="start" name="caret-down-outline"></ion-icon>
          <ion-ripple-effect type="bounded"></ion-ripple-effect>
        </ion-label>
      </div>
      <div class="small_flex_div">

        <div class="addBtn"
          *ngIf="!cart.checkProductInCart(product.uuid) && product.quantiy <= 0 && product.in_stock === '1'">
          <div class="ion-activatable ripple-parent" (click)="addToCart()">
            {{util.getString('Add to Cart')}}
            <ion-ripple-effect></ion-ripple-effect>
          </div>
        </div>

        <div class="abs_add" *ngIf="cart.checkProductInCart(id)">
          <img src="assets/imgs/remove.png" (click)="remove()">
          <ion-label>{{product.quantiy}}</ion-label>
          <img src="assets/imgs/add.png" (click)="add()">
        </div>
      </div>

      <div class="pro_desc_div" *ngIf="description">
        <ion-label class="head_lbl"> {{util.getString('Description')}} </ion-label>
        <ion-label class="light_lbl"> {{description}} </ion-label>
      </div>

      <div class="pro_desc_div" *ngIf="key_features">
        <ion-label class="head_lbl"> {{util.getString('Highlight')}} </ion-label>
        <ion-label class="light_lbl"> {{key_features}} </ion-label>
      </div>

      <div class="pro_desc_div" *ngIf="disclaimer">
        <ion-label class="head_lbl"> {{util.getString('Desclaimer')}} </ion-label>
        <ion-label class="light_lbl"> {{disclaimer}} </ion-label>
      </div>

      <div class="related" *ngIf="related?.length">
        <ion-label class="head_lbl"> {{util.getString('Related')}} </ion-label>
        <ion-slides [options]="slideOpts1">
          <ion-slide *ngFor="let item of related">
            <div style="border: 1px solid lightgray;margin-right: 10px;border-radius: 5px; width: 100%;">
              <div class="back_image"
                [ngStyle]="{'background-image':'url('+api.mediaURL+item.cover+'),url(assets/imgs/product.png)'}"
                (click)="singleProduct(item)">
                <div class="percent" *ngIf="item.discount_type !== 'none' && item.discount > 0"> 
                  <span style="display: flex;
                  font-weight: bold;
                  color: white;
                  top: 8px;
                  left: 18px;
                  position: absolute;
                  font-size: 12px;">{{+item.discount}}</span> 
                </div>
                <div *ngIf="item.in_stock === '0'" class="notInStock">
                  <ion-label class="text"> {{util.getString('Out of Stock')}} </ion-label>
                </div>
                <img src="assets/imgs/normal.png" class="kind" alt="Verified" *ngIf="item.verified_at !== null">
                <img src="assets/imgs/verified.png" class="kind" alt="Normal" *ngIf="item.verified_at === null">
              </div>
              <div class="second_div">
                <ion-label class="name_lbl" (click)="singleProduct(item)">
                  {{ (item.name.length>10)? (item.name | slice:0:10)+'..':(item.name) }}
                </ion-label>
                <ion-label class="itemsKind">
                  <span *ngIf="item.have_gram === '1'"> {{item.gram}} {{util.getString('grams')}} </span>
                  <span *ngIf="item.have_kg === '1'"> {{item.kg}} {{util.getString('kg')}} </span>
                  <span *ngIf="item.have_liter ==='1'"> {{item.liter}} {{util.getString('ltr')}} </span>
                  <span *ngIf="item.have_ml ==='1'"> {{item.ml}} {{util.getString('ml')}} </span>
                  <span *ngIf="item.have_pcs === '1'"> {{item.pcs}} {{util.getString('pcs')}} </span>
                </ion-label>
                <!-- <ion-label class="desc" (click)="singleProduct(item)">
                  {{ (item.descriptions.length>40)? (item.descriptions | slice:0:40)+'..':(item.descriptions) }}
                </ion-label> -->
                <ion-label class="price_lbl" *ngIf="item.discount === '0' && util.cside ==='left'"> {{util.currecny}}
                  {{item.orig_price}} </ion-label>
                <ion-label class="price_lbl" *ngIf="item.discount === '0' && util.cside ==='right'">
                  {{item.orig_price}}
                  {{util.currecny}}</ion-label>
                <ion-label class="price_lbl" *ngIf="item.discount !== '0'" (click)="singleProduct(item)">
                  <span class="original" *ngIf="util.cside ==='left'"> {{util.currecny}} {{item.orig_price}} </span>
                  <span class="sell" *ngIf="util.cside ==='left'">{{util.currecny}} {{item.sell_price}} </span>

                  <span class="original" *ngIf="util.cside ==='right'"> {{item.orig_price}} {{util.currecny}}</span>
                  <span class="sell" *ngIf="util.cside ==='right'"> {{item.sell_price}} {{util.currecny}}</span>
                </ion-label>
              </div>
            </div>
          </ion-slide>
        </ion-slides>
      </div>

    </div>
  </div>
</ion-content>